# Procedure for Future Projected Land Cover Change

This document describes the procedure for generating VIC parameters for projected future land cover change. This procedure assumes we have started with a set of land cover maps corresponding to at least one historical map and at least one future projection using the same classification scheme. The historical map should be used to generate historical VIC parameters via the "NLCD_INEGI" version of the [main procedure](Procedure.md).

The future parameters are then generated by (1) aggregating the future land cover map (ascii-format ESRI grid file) to area fractions at the desired resolution; (2) replacing the `Cv` variable in the historical VIC parameter file with the area fractions from step (1); and (3) filling gaps in the parameters (cells for which classes have appeared in the future that did not exist there in the historical map) by spatially interpolating the parameters for those classes from neighboring cells.

## 1. Aggregate land cover map

This step aggregates a land cover map (ascii-format ESRI grid file) to area fractions at the desired resolution, in NetCDF format. The area fractions are stored in a variable named `Cv`. Run the following script:

`aggregate_lc_map.py -d $DOMAIN_FILE -m $LC_MAP_FILE -t $LC_TABLE -o $OUTFILE`

where

`$DOMAIN_FILE` = VIC-5-image-mode-compliant domain file (NetCDF)
`$LC_MAP_FILE` = ESRI ascii-format land cover map
`$LC_TABLE` = Ascii comma-separated-value (csv) file listing the land cover classes, and their names, similar to [../data/USMX/lc_table.USMX.NLCD_INEGI.csv](../data/USMX/lc_table.USMX.NLCD_INEGI.csv)
`$OUTFILE` = output path/filename

## 2. Replace Cv in historical parameter file

This step replaces the `Cv` variable of a historical VIC parameter file with the `Cv` variable generated in step 1. Run the following script:

`replace_cv.py -i $INFILE -c $CV_FILE -o $OUTFILE`

where

`$INFILE` = VIC-5-image-mode-compliant historical parameter file
`$CV_FILE` = NetCDF file containing new `Cv` variable, created in step 1
`$OUTFILE` = output path/filename (this will be the historical VIC parameters but with the future `Cv`)

## 3. Fill gaps

This step fills gaps in the parameters (arising from classes appearing in cells where no parameters exist for them) by spatial interpolation from neghboring cells. Run the following script:

`gapfill_vic_params.py -i $INFILE [-a] [-r] [-m] -o $OUTFILE`

where

`$INFILE` = modified VIC parameter file created in step 2
`-a` = optional flag specifying that a `max_snow_albedo` variable is present
`-r` = optional flag specifying that irrigation variables are present
`-m` = optional flag specifying that impervious area fraction variables are present
`$OUTFILE` = output path/filename for gap-filled parameters

NOTE: the `-r` and `-m` options are only applicable to the `feature/irrig.imperv.deep_esoil` branch of the `tbohn/VIC` fork of the `UW-Hydro/VIC` GitHub repo, available at [https://github.com/tbohn/VIC/tree/feature/irrig.imperv.deep_esoil](https://github.com/tbohn/VIC/tree/feature/irrig.imperv.deep_esoil).
